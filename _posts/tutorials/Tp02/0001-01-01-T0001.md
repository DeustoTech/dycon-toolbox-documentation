---
title: First Example
author: JOroya
description: First Example
date: 2019-01-01
number: 1
layout: tutorial
matlab: T0001_ControlProblemODE
categories: [tutorial,Tp02]
---

En DyCon toolbox se ha definido el problema de control optimo a traves de la minimizacion de un funcional. De esta forma podemos resolver problemas del tipo


$$ \min_{U \in \Omega } \Psi(t,Y(T)) + \int_0^T L(t,Y,U) dt $$


sujecto a


$$ \dot{Y} = f(t,Y,U) $$


Se ha creado una interfaz simbolica para la definici&#65533;n de la dinamica. Por ello que deberemos definir un vector simbolico $Y$, que representara el estado de la dinamica, ademas de una vector simbolico $U$ que representara el vector de control.


Continuar&#65533;mos con un ejemplo para simplificar.


Supongamos que queremos encontrar el control que minimiza el funcional:


$$ y_1^2 + y_2^2 + \int_0^2 u_1^2 + u_2^2 dt


sujeto a


$$ \left( \begin{matrix}       \dot{y_1} \\       \dot{y_2}     \end{matrix} \right)    =     \left( \begin{matrix}               y_2     \\               y_2      \end{matrix} \right) $$


Deberemos inicializar los vectores de control y de estado.

```matlab
Y = sym('y',[2 1])
```


```
 
Y =
 
 y1
 y2
 

```

```matlab
U = sym('u',[1 1])
```


```
 
U =
 
u1
 

```


Una vez definidos podemos crear un vector simbolico con las misma dimensiones que el vector de estado. Este vector representara la dinamica del problema. Sigiendo la notacion utilizada al principio este vector ser&#65533; $f(t,Y,U)$

```matlab
 F = [ Y(2)          ; ...
      -Y(2) + U(1) ] ;
```


Utilizando el contructor de 'ode'

```matlab
dynamics = ode(F,Y,U)
```


```

dynamics = 

  ode with properties:

     VectorState: [1x1 struct]
         Control: [1x1 struct]
         Dynamic: [1x1 struct]
       Condition: [2x1 double]
            Type: 'InitialCondition'
       FinalTime: 1
              dt: 0.1000
           label: ''
        RKMethod: @ode45
    RKParameters: {}
             PDE: 0
           tspan: [1x11 double]
            Udim: 1


```


Esta es una objecto que representa la ecuacion diferencial


mochos de los par&#65533;metros que definen la ecuacion han sido tomados por defecto. Espro ello que deberemos personalizarlo. Para que representa la dinamica que queramos. En este caso cambiaremos la condicion inicial y el intervalo en el tiempo

```matlab
dynamics.Condition = [0;-1];
dynamics.dt = 0.01;
```


Un vez definido la dinamica podemos definir el funcional que minizaremos. Este funciona tendra que ser representado con las mismas variables con la que se ha definido la dinamica. Siguiendo la forma presentada en [1] deberemos definir las expresiones de $\Psi$ y $L$

```matlab
Psi = sym(0);
L   = 0.005*(U.'*U) +  Y.'*Y ;
```


Ya habiendo creado la ecuacion diferencial y las expresiones para $\Psi$ y $L$, podemos definir el problemas de control optimo de la siguiente manera:

```matlab
iP = OptimalControl(dynamics,Psi,L);
```


Este contiene informacion que puede ser de ayuda para la resolucion del problema. Es importante notar que no estamos resolviendo el problema. Simplemente lo estamos definiendo. Los solvers seran metodos que actuan sobre este objeto.

```matlab
iP
```


```

iP = 

  OptimalControl with properties:

              J: [1x1 struct]
            ode: [1x1 ode]
        adjoint: [1x1 struct]
    hamiltonian: [1x1 symfun]
       gradient: [1x1 struct]
       solution: []
             YT: []


```


Uno de estos solver es el Gradient method. Este simplemnte calcula un gradiente con ayuda de la condiciones de optimalidad de primer orden extraida del principio del minimo de pontryagin. Para resolver el problema con este m&#65533;todo, simplemnte escribimos:

```matlab
GradientMethod(iP)
```


```

    Solve with presicion: 

        We obtain: J(u) = 6.971327E-02

        mean(||dJ_i||) = 3.103674E-04

    With 8 iterations,     In 12.3172 seconds


```


Gradient Method crea un soluci&#65533;n para el problema.

```matlab
iP.solution
```


```

ans = 

  CPSolution with properties:

    precision: 3.1037e-04
         iter: 8
         time: 12.3172
     Yhistory: {1x8 cell}
     Uhistory: {1x8 cell}
     Jhistory: [0.6004 0.1614 0.0881 0.0724 0.0716 0.0699 0.0699 0.0697]
    dJhistory: {1x8 cell}
     Ehistory: [0 0.0388 0.0087 0.0026 0.0182 0.0014 0.0052 3.1037e-04]
     timeline: []
           du: []
     UOptimal: [101x1 double]
     JOptimal: 0.0697


```


Gracias a que la estructura es unica independiente del solver, podemos implentar funciones de visualizaci&#65533;n para todos tipo de solver. Un ejemplo de esto es la funcion plot aplicado a los objetos OptimalControl

```matlab
plot(iP)
```


![]({{site.url}}/{{site.baseurl}}/assets/imgs/tutorials/Tp02/T0001/copiaRM_01.png)

