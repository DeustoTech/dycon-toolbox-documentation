<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Welcome to the web interface of DyCon Toolbox, the computational platform developed within the <a href='https://cmc.deusto.eus/dycon/' target='_blank'>ERC DyCon - Dynamic Control</a> project.">



	<link rel='shortcut icon' type='image/png' href='/dycon-platform-documentation/favicon.png' />

    <title>Average Control Stochas - DyCon Platform</title>

    <link rel="canonical" href="https://DeustoTech.github.io/dycon-platform-documentation/tutorial/tp03/T0002">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="https://DeustoTech.github.io/dycon-platform-documentation/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="https://DeustoTech.github.io/dycon-platform-documentation/css/clean-blog.css">

	<!-- Adjust Colors -->
    <link rel="stylesheet" href="https://DeustoTech.github.io/dycon-platform-documentation/colorscheme.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="https://DeustoTech.github.io/dycon-platform-documentation/css/syntax.css">

    <!-- Custom Fonts -->
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
  	<link href="https://fonts.googleapis.com/css?family=Roboto+Slab" rel="stylesheet">
  	<link href="https://fonts.googleapis.com/css?family=Lusitana" rel="stylesheet">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
	<!-- Math Jax -->
	<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
	<script type="text/x-mathjax-config">
	MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [['$','$'], ['\\(','\\)']]
    },
		TeX: {
      equationNumbers: {
        autoNumber: "AMS"
      }
    },
    /*CommonHTML: {
      scale: 300
    }*/
	});
	</script>

	<!--<script src="http://cdnjs.cloudflare.com/ajax/libs/d3/3.4.13/d3.min.js" type="text/javascript"></script>-->

    <!-- jQuery -->
	<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>

	<!-- Bootstrap Core JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>

	<!-- Custom Theme JavaScript -->
	<script src="https://DeustoTech.github.io/dycon-platform-documentation/js/clean-blog.min.js "></script>

</head>


<body>

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/dycon-platform-documentation/">
                 <img src="https://DeustoTech.github.io//dycon-platform-documentation/img/logos/logo_DyCon.png" >
            </a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="/dycon-platform-documentation/">Home</a>
                </li>
				
                <li>
                    <a href="/dycon-platform-documentation/projects/documentation">Documentation</a>
                </li>
                
                <li>
                    <a href="/dycon-platform-documentation/projects/tutorials">Tutorials</a>
                </li>
                
                
                <li>
                    <a href="/dycon-platform-documentation/Download">Downloads</a>
                </li>
                
                <li>
                        <a href="http://cmc.deusto.eus/">Chair of Computational Mathematics</a>
                </li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>


    <!-- Post Header -->
<header class="intro-header">
    <div class="container" style="padding-top: 70px;">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading" style="padding: 0px 0">
                    <h1>Average Control Stochas</h1>

					<span class="meta">Posted by:
					
						• <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name"><a href="">Alejandro Cunillera</a></span></span>
					
					</span>
					<div class="shadowbox">
						<p>To start this tutorial, write the following command in the MATLAB console
							<pre class="highlight"><code><span class="nb">open average_control_by_stoch_gradient_step</span></code></pre>
						</p>
					</div>


                </div>
            </div>
		</div>


	</div>
</header>


<!-- Post Content -->
<style>
img {
	display:block;
	max-width:  100%;
	margin-left: auto;
	margin-right: auto;
}

@media only screen and (min-width: 1000px) {
img {
	-moz-transition:-moz-transform 0.5s ease-in; 
	-webkit-transition:-webkit-transform 0.5s ease-in; 
	-o-transition:-o-transform 0.5s ease-in;
}
img:active{
	-moz-transform:scale(1.2); 
	-webkit-transform:scale(1.2);
	-o-transform:scale(1.2);
}
}

@media only screen and (min-width: 1250px) {
img {
	-moz-transition:-moz-transform 0.5s ease-in; 
	-webkit-transition:-webkit-transform 0.5s ease-in; 
	-o-transition:-o-transform 0.5s ease-in;
}
img:active{
	-moz-transform:scale(1.5); 
	-webkit-transform:scale(1.5);
	-o-transform:scale(1.5);
}
}

@media only screen and (min-width: 1500px) {
img {
	-moz-transition:-moz-transform 0.5s ease-in; 
	-webkit-transition:-webkit-transform 0.5s ease-in; 
	-o-transition:-o-transform 0.5s ease-in;
}
img:active{
	-moz-transform:scale(2); 
	-webkit-transform:scale(2);
	-o-transform:scale(2);
}
}
</style>

<article>
    <div id="content" class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">

				<p>In this work, we address the optimal control of parameter-dependent systems. We introduce the notion of averaged control in which the quantity of interest is the average of the states with respect to the parameter family <script type="math/tex">\mathcal{K}= \left\{ \nu_i \in \mathbb{R}, \enspace 1\leq i \leq K \right\}.</script></p>

<p>In this case $\nu_i$ are:</p>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">nu</span> <span class="o">=</span> <span class="mi">1</span><span class="p">:</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">6</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
nu =

  Columns 1 through 7

    1.0000    1.1000    1.2000    1.3000    1.4000    1.5000    1.6000

  Columns 8 through 14

    1.7000    1.8000    1.9000    2.0000    2.1000    2.2000    2.3000

  Columns 15 through 21

    2.4000    2.5000    2.6000    2.7000    2.8000    2.9000    3.0000

  Columns 22 through 28

    3.1000    3.2000    3.3000    3.4000    3.5000    3.6000    3.7000

  Columns 29 through 35

    3.8000    3.9000    4.0000    4.1000    4.2000    4.3000    4.4000

  Columns 36 through 42

    4.5000    4.6000    4.7000    4.8000    4.9000    5.0000    5.1000

  Columns 43 through 49

    5.2000    5.3000    5.4000    5.5000    5.6000    5.7000    5.8000

  Columns 50 through 51

    5.9000    6.0000


</code></pre></div></div>

<p>And save in K, the number of values</p>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">K</span> <span class="o">=</span> <span class="nb">length</span><span class="p">(</span><span class="n">nu</span><span class="p">);</span>
</code></pre></div></div>

<p>Where the finite dimensional linear control system is:</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align*}  \left\{ \begin{array}{ll} x^\prime \left( t \right) = A \left( \nu \right) x \left( t \right) + B \left( \nu \right) u \left( t \right), \quad 0 < t <T, \\ x\left( 0 \right) = x^0. \end{array} \right. \end{align*} %]]></script>

<p>We can, define the initial state of all ode’s</p>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">N</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span> <span class="c1">% dimension of vector state</span>
<span class="n">x0</span> <span class="o">=</span> <span class="nb">ones</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</code></pre></div></div>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">%Moreover, we can define the matrix A's and B's, that determine the problem</span>
<span class="n">Am</span> <span class="o">=</span> <span class="o">-</span><span class="nb">triu</span><span class="p">(</span><span class="nb">ones</span><span class="p">(</span><span class="n">N</span><span class="p">));</span>
</code></pre></div></div>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Bm</span> <span class="o">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="n">Bm</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</code></pre></div></div>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">A</span> <span class="o">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">K</span><span class="p">);</span>
<span class="n">B</span> <span class="o">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">K</span><span class="p">);</span>
<span class="k">for</span> <span class="n">index</span> <span class="o">=</span> <span class="mi">1</span><span class="p">:</span><span class="n">K</span>
    <span class="n">A</span><span class="p">(:,:,</span><span class="n">index</span><span class="p">)</span> <span class="o">=</span> <span class="n">Am</span> <span class="o">+</span> <span class="p">(</span><span class="n">nu</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">)</span><span class="o">*</span><span class="nb">diag</span><span class="p">(</span><span class="nb">diag</span><span class="p">(</span><span class="n">Am</span><span class="p">));</span>
    <span class="n">B</span><span class="p">(:,:,</span><span class="n">index</span><span class="p">)</span> <span class="o">=</span> <span class="n">Bm</span><span class="p">;</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Also, need define a initial control, that will be evolve</p>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dt</span> <span class="o">=</span> <span class="mf">0.02</span><span class="p">;</span> <span class="n">t0</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">T</span>  <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="n">span</span> <span class="o">=</span> <span class="p">(</span><span class="n">t0</span><span class="p">:</span><span class="n">dt</span><span class="p">:</span><span class="n">T</span><span class="p">);</span>
<span class="c1">%</span>
<span class="n">u0</span> <span class="o">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="nb">length</span><span class="p">(</span><span class="n">span</span><span class="p">),</span><span class="mi">1</span><span class="p">);</span>
</code></pre></div></div>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">xt</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">0</span> <span class="mf">0.0</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">]</span><span class="o">'</span><span class="p">;</span>
</code></pre></div></div>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">AverageProblemSG</span> <span class="o">=</span> <span class="n">ControlParameterDependent</span><span class="o">.</span><span class="nb">empty</span><span class="p">;</span>
<span class="n">AverageProblemCG</span> <span class="o">=</span> <span class="n">ControlParameterDependent</span><span class="o">.</span><span class="nb">empty</span><span class="p">;</span>
<span class="n">index_nu</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="k">for</span> <span class="n">dnu</span><span class="o">=</span> <span class="mf">0.1</span><span class="p">:</span><span class="mf">0.5</span><span class="p">:</span><span class="mi">1</span>
</code></pre></div></div>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="n">index_nu</span> <span class="o">=</span> <span class="n">index_nu</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">nu</span> <span class="o">=</span> <span class="mi">1</span><span class="p">:</span><span class="n">dnu</span><span class="p">:</span><span class="mi">6</span><span class="p">;</span>
</code></pre></div></div>

<p>And save in K, the number of values</p>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="n">K</span> <span class="o">=</span> <span class="nb">length</span><span class="p">(</span><span class="n">nu</span><span class="p">);</span>

    <span class="n">N</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span> <span class="c1">% dimension of vector state</span>
    <span class="n">x0</span> <span class="o">=</span> <span class="nb">ones</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</code></pre></div></div>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="c1">%Moreover, we can define the matrix A's and B's, that determine the problem</span>
    <span class="n">Am</span> <span class="o">=</span> <span class="o">-</span><span class="nb">triu</span><span class="p">(</span><span class="nb">ones</span><span class="p">(</span><span class="n">N</span><span class="p">));</span>
</code></pre></div></div>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="n">Bm</span> <span class="o">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">Bm</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</code></pre></div></div>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="n">A</span> <span class="o">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">K</span><span class="p">);</span>
    <span class="n">B</span> <span class="o">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">K</span><span class="p">);</span>
    <span class="k">for</span> <span class="n">index</span> <span class="o">=</span> <span class="mi">1</span><span class="p">:</span><span class="n">K</span>
        <span class="n">A</span><span class="p">(:,:,</span><span class="n">index</span><span class="p">)</span> <span class="o">=</span> <span class="n">Am</span> <span class="o">+</span> <span class="p">(</span><span class="n">nu</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">)</span><span class="o">*</span><span class="nb">diag</span><span class="p">(</span><span class="nb">diag</span><span class="p">(</span><span class="n">Am</span><span class="p">));</span>
        <span class="n">B</span><span class="p">(:,:,</span><span class="n">index</span><span class="p">)</span> <span class="o">=</span> <span class="n">Bm</span><span class="p">;</span>
    <span class="k">end</span>
    <span class="n">AverageProblemSG</span><span class="p">(</span><span class="n">index_nu</span><span class="p">)</span> <span class="o">=</span> <span class="n">ControlParameterDependent</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="p">,</span><span class="n">x0</span><span class="p">,</span><span class="n">u0</span><span class="p">,</span><span class="n">span</span><span class="p">);</span>
    <span class="n">AverageProblemCG</span><span class="p">(</span><span class="n">index_nu</span><span class="p">)</span> <span class="o">=</span> <span class="n">ControlParameterDependent</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="p">,</span><span class="n">x0</span><span class="p">,</span><span class="n">u0</span><span class="p">,</span><span class="n">span</span><span class="p">);</span>


    <span class="n">AverageClassicalGradient</span><span class="p">(</span><span class="n">AverageProblemSG</span><span class="p">(</span><span class="n">index_nu</span><span class="p">),</span><span class="n">xt</span><span class="p">)</span>
    <span class="n">AverageStochasticGradient</span><span class="p">(</span><span class="n">AverageProblemCG</span><span class="p">(</span><span class="n">index_nu</span><span class="p">),</span><span class="n">xt</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">end</span>

<span class="n">addta</span> <span class="o">=</span> <span class="p">[</span><span class="n">AverageProblemSG</span><span class="o">.</span><span class="n">addata</span><span class="p">];</span>
<span class="n">time_executions</span> <span class="o">=</span>  <span class="p">[</span><span class="n">addta</span><span class="o">.</span><span class="n">time_execution</span><span class="p">];</span>


<span class="c1">% AverageProblemCG = AverageControl(A,B,x0,u0,span);</span>
<span class="c1">% plot(AverageProblemCG)</span>
<span class="c1">%</span>
<span class="c1">% AverageProblemSG = copy(AverageProblemCG);</span>
<span class="c1">% solveStochasticGradient(AverageProblemSG,xt)</span>
<span class="c1">% plot(AverageProblemSG)</span>
<span class="c1">%</span>
<span class="c1">%animation(AverageProblem,'dt',0.1,'ULim',[-10 20],'XLim',[-2 2])</span>
</code></pre></div></div>

<h2 id="references">References</h2>



                <hr>

            </div>
        </div>
    </div>
</article>


<hr>


    <!-- Footer -->
<footer>
  <hr>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center">
          <li>
            <img style="width: 200px;" src="/dycon-platform-documentation/img/logos/logo_DyCon.png " alt="">
          </li>
          <li>
            <img style="width: 250px;" src="/dycon-platform-documentation/img/logos/logo_CCM_subDerecha_v002.png " alt="">
          </li>
        </ul>
      </div>
    </div>
  </div>
</footer>


</body>

</html>
