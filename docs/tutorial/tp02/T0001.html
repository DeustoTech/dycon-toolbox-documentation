<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Welcome to the web interface of DyCon Toolbox, the computational platform developed within the <a href='https://cmc.deusto.eus/dycon/' target='_blank'>ERC DyCon - Dynamic Control</a> project.">



	<link rel='shortcut icon' type='image/png' href='/dycon-platform-documentation/favicon.png' />

    <title>First Example of Optimal Control Problems - DyCon Toolbox</title>

    <link rel="canonical" href="https://DeustoTech.github.io/dycon-platform-documentation/tutorial/tp02/T0001">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="https://DeustoTech.github.io/dycon-platform-documentation/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="https://DeustoTech.github.io/dycon-platform-documentation/css/clean-blog.css">

	<!-- Adjust Colors -->
    <link rel="stylesheet" href="https://DeustoTech.github.io/dycon-platform-documentation/colorscheme.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="https://DeustoTech.github.io/dycon-platform-documentation/css/syntax.css">

    <!-- Custom Fonts -->
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
  	<link href="https://fonts.googleapis.com/css?family=Roboto+Slab" rel="stylesheet">
  	<link href="https://fonts.googleapis.com/css?family=Lusitana" rel="stylesheet">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
	<!-- Math Jax -->
	<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
	<script type="text/x-mathjax-config">
	MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [['$','$'], ['\\(','\\)']]
    },
		TeX: {
      equationNumbers: {
        autoNumber: "AMS"
      }
    }
	});
	</script>

	<!--<script src="http://cdnjs.cloudflare.com/ajax/libs/d3/3.4.13/d3.min.js" type="text/javascript"></script>-->

    <!-- jQuery -->
	<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>

	<!-- Bootstrap Core JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>

	<!-- Custom Theme JavaScript -->
    <script src="https://DeustoTech.github.io/dycon-platform-documentation/js/clean-blog.min.js "></script>
    
 	<!-- 404  JavaScript -->

</head>


<body>

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/dycon-platform-documentation/">
                 <img src="https://DeustoTech.github.io//dycon-platform-documentation/assets/logo_DyConToolbox_v001.png" >
            </a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="/dycon-platform-documentation/">Home</a>
                </li>
                
                
                <li>
                    <a href="/dycon-platform-documentation/projects/01-documentation">Documentation</a>
                </li>
                
                
                
                <li>
                    <a href="/dycon-platform-documentation/projects/02-tutorials">First Steps</a>
                </li>
                
                
                
                <li>
                    <a href="/dycon-platform-documentation/projects/03-examples">Examples</a>
                </li>
                
                
                
                <li>
                    <a href="/dycon-platform-documentation/projects/04-download">Downloads</a>
                </li>
                
                
                
                <li>
                        <a href="http://cmc.deusto.eus/">Chair of Computational Mathematics</a>
                </li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>


    <!-- Post Header -->
<header class="intro-header">
    <div class="container" style="padding-top: 70px;">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading" style="padding: 0px 0"><h2><small>First Step</small></h2>
                    <h1>First Example of Optimal Control Problems</h1>

					<div class="shadowbox">
						<p>To start this tutorial, write the following command in the MATLAB console
							<pre class="highlight"><code><span class="nb">open T0001_ControlProblemODE</span></code></pre>
						</p>
					</div>


                </div>
            </div>
		</div>


	</div>
</header>


<!-- Post Content -->
<style>
img {
	display:block;
	max-width:  100%;
	margin-left: auto;
	margin-right: auto;
}

@media only screen and (min-width: 1000px) {
img {
	-moz-transition:-moz-transform 0.5s ease-in; 
	-webkit-transition:-webkit-transform 0.5s ease-in; 
	-o-transition:-o-transform 0.5s ease-in;
}
img:active{
	-moz-transform:scale(1.2); 
	-webkit-transform:scale(1.2);
	-o-transform:scale(1.2);
}
}

@media only screen and (min-width: 1250px) {
img {
	-moz-transition:-moz-transform 0.5s ease-in; 
	-webkit-transition:-webkit-transform 0.5s ease-in; 
	-o-transition:-o-transform 0.5s ease-in;
}
img:active{
	-moz-transform:scale(1.5); 
	-webkit-transform:scale(1.5);
	-o-transform:scale(1.5);
}
}

@media only screen and (min-width: 1500px) {
img {
	-moz-transition:-moz-transform 0.5s ease-in; 
	-webkit-transition:-webkit-transform 0.5s ease-in; 
	-o-transition:-o-transform 0.5s ease-in;
}
img:active{
	-moz-transform:scale(2); 
	-webkit-transform:scale(2);
	-o-transform:scale(2);
}
}
</style>

<article>
    <div id="content" class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">

				<p>DyCon toolbox adopts Pontryagin’s maximum principle to optimize the control function for each control problem. In this way we can solve problems of the form:</p>

<script type="math/tex; mode=display">\min_{U \in \Omega } \Psi(t,Y(T)) + \int_0^T L(t,Y,U) dt,</script>

<p>subject to</p>

<script type="math/tex; mode=display">\dot{Y} = f(t,Y,U).</script>

<p>‘OptimalControl’ class uses symbolic interface to define a control problem as in ‘ode’ class. ‘OptimalControl’ class contains ‘ode’ class, the final cost, and running cost. As ‘ode’ class contains $ f $, the final cost $ \Psi $ and running cost $ L $ should be given by symbolic functions.</p>

<p>Here we explain ‘OptimalControl’ class with a simple example: we want to minimize the objective function</p>

<script type="math/tex; mode=display">J (Y,U) := \int_0^2 (y_1^2 + y_2^2) + 0.005(u_1^2 + u_2^2) dt,</script>

<p>subject to</p>

<script type="math/tex; mode=display">\left( \begin{matrix}       \dot{y_1} \\       \dot{y_2}     \end{matrix} \right)    =     \left( \begin{matrix}               y_2     \\               -y_2+u_1      \end{matrix} \right)</script>

<p>%%%% The dynamics and cost functions are based on symbolic vectors $ Y $ and $ U $, which represent the state of the dynamics and control vector.</p>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Y</span> <span class="o">=</span> <span class="n">sym</span><span class="p">(</span><span class="s1">'y'</span><span class="p">,[</span><span class="mi">2</span> <span class="mi">1</span><span class="p">])</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> 
Y =
 
 y1
 y2
 

</code></pre></div></div>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">U</span> <span class="o">=</span> <span class="n">sym</span><span class="p">(</span><span class="s1">'u'</span><span class="p">,[</span><span class="mi">1</span> <span class="mi">1</span><span class="p">])</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> 
U =
 
u1
 

</code></pre></div></div>

<p>The dynamics of $ Y $ should be given by a symbolic vector with the same dimensions as the state vector. Following the notation at the beginning, this vector represents $ f (t, Y, U) $:</p>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="n">F</span> <span class="o">=</span> <span class="p">[</span> <span class="n">Y</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>          <span class="p">;</span> <span class="k">...</span>
      <span class="o">-</span><span class="n">Y</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">U</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">]</span> <span class="p">;</span>
</code></pre></div></div>

<p>Using this dynamics vector, we construct an ‘ode’ class.</p>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dynamics</span> <span class="o">=</span> <span class="n">ode</span><span class="p">(</span><span class="n">F</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">U</span><span class="p">)</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
dynamics = 

  ode with properties:

     VectorState: [1x1 struct]
         Control: [1x1 struct]
         Dynamic: [1x1 struct]
       Condition: [2x1 double]
            Type: 'InitialCondition'
       FinalTime: 1
              dt: 0.1000
           label: ''
        RKMethod: @ode45
    RKParameters: {}
             PDE: 0
           tspan: [1x11 double]
            Udim: 1


</code></pre></div></div>

<p>The printed information above shows the default setting of this ‘ode’ class. In order to construct the dynamics we want, we need to customize its parameters. In this case we change the initial condition for the dynamics and the sampling timestep.</p>

<p>The time discretization is generated as a uniform mesh from the timestep $ dt $. It will be used not only for the sampling of the state vector $ Y $ but also to represent the control vector $ U $ and cost $ J $ in ‘OptimalControl’ class.</p>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dynamics</span><span class="o">.</span><span class="n">Condition</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">;</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span>
<span class="n">dynamics</span><span class="o">.</span><span class="n">dt</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">;</span>
</code></pre></div></div>

<p>Next we need to define the functional $ J $ we want to minimize. Following the form presented in [1], we define the expressions of $ \ Psi $ and $ L $ in symbolic form:</p>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Psi</span> <span class="o">=</span> <span class="n">sym</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="n">L</span>   <span class="o">=</span> <span class="mf">0.005</span><span class="o">*</span><span class="p">(</span><span class="n">U</span><span class="o">.</span><span class="s1">'*U)+Y.'</span><span class="o">*</span><span class="n">Y</span> <span class="p">;</span>
</code></pre></div></div>

<p>We finally define the optimal control problem as a ‘OptimalControl’ class:</p>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iP</span> <span class="o">=</span> <span class="n">OptimalControl</span><span class="p">(</span><span class="n">dynamics</span><span class="p">,</span><span class="n">Psi</span><span class="p">,</span><span class="n">L</span><span class="p">);</span>
</code></pre></div></div>

<p>This class contains information we need to find the optimal control vector $ U $. It is worth mentioning that until now we defined the problem but not solved it yet.</p>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iP</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
iP = 

  OptimalControl with properties:

              J: [1x1 struct]
            ode: [1x1 ode]
        adjoint: [1x1 struct]
    hamiltonian: [1x1 symfun]
       gradient: [1x1 struct]
       solution: []
             YT: []


</code></pre></div></div>

<p>DyCon toolbox uses the gradient methods to optimize the cost functional. This calculates the gradient of $ J $ along $ U $ from the first order approximation of the Hamiltonian and adjoint state vector in the Pontryagin principle.</p>

<p>To solve the problem using the default gradient method, we simply write:</p>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">GradientMethod</span><span class="p">(</span><span class="n">iP</span><span class="p">)</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
    Solve with presicion: 

        We obtain: J(u) = 6.968801E-02

        mean(||dJ_i||) = 7.781027E-05

    With 10 iterations,     In 8.9069 seconds


</code></pre></div></div>

<p>This command generates ‘solution’ in the ‘OptimalControl’ class, which contains the optimal control vector ‘UOptimal’ and its information, such as the cost, precision and time of computations.</p>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iP</span><span class="o">.</span><span class="n">solution</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
ans = 

  CPSolution with properties:

    precision: 7.7810e-05
         iter: 10
         time: 8.9069
     Yhistory: {1x10 cell}
     Uhistory: {1x10 cell}
     Jhistory: [1x10 double]
    dJhistory: {1x10 cell}
     Ehistory: [1x10 double]
     timeline: []
           du: []
     UOptimal: [101x1 double]
     JOptimal: 0.0697


</code></pre></div></div>

<p>This structure is independent of the solver, and we can see the results through visualization functions we want. One of the examples is ‘plot’ function which can be applied to ‘OptimalControl’ class.</p>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">plot</span><span class="p">(</span><span class="n">iP</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="https://DeustoTech.github.io//dycon-platform-documentation/assets/imgs/tutorials/Tp02/T0001/copiaRM_01.png" alt="" /></p>



                <hr>

            </div>
        </div>
    </div>
</article>


<hr>


    <!-- Footer -->
<footer>
  <hr>
  <div class="container">
    <div class="row">
      <div class="col-md-10">
        <ul class="list-inline text-center">
          <li>
            <img style="width: 200px;" src="/dycon-platform-documentation/img/logos/logo_DyCon.png " alt="">
          </li>
          <li>
            <img style="width: 250px;" src="/dycon-platform-documentation/img/logos/logo_CCM_subDerecha_v002.png " alt="">
          </li>
        </ul>
      </div>
    </div>
  </div>
</footer>


</body>

</html>
