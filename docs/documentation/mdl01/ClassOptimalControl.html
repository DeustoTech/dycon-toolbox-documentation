<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Welcome to the web interface of DyCon Toolbox, the computational platform developed within the <a href='https://cmc.deusto.eus/dycon/' target='_blank'>ERC DyCon - Dynamic Control</a> project.">



	<link rel='shortcut icon' type='image/png' href='/dycon-toolbox-documentation/favicon.png' />

    <title>OptimalControl - DyCon Toolbox</title>

    <link rel="canonical" href="https://DeustoTech.github.io/dycon-toolbox-documentation/documentation/mdl01/ClassOptimalControl">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="https://DeustoTech.github.io/dycon-toolbox-documentation/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="https://DeustoTech.github.io/dycon-toolbox-documentation/css/clean-blog.css">

	<!-- Adjust Colors -->
    <link rel="stylesheet" href="https://DeustoTech.github.io/dycon-toolbox-documentation/colorscheme.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="https://DeustoTech.github.io/dycon-toolbox-documentation/css/syntax.css">

    <!-- Custom Fonts -->
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
  	<link href="https://fonts.googleapis.com/css?family=Roboto+Slab" rel="stylesheet">
  	<link href="https://fonts.googleapis.com/css?family=Lusitana" rel="stylesheet">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
	<!-- Math Jax -->
	<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
	<script type="text/x-mathjax-config">
	MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [['$','$'], ['\\(','\\)']]
    },
		TeX: {
      equationNumbers: {
        autoNumber: "AMS"
      }
    }
	});
	</script>

	<!--<script src="http://cdnjs.cloudflare.com/ajax/libs/d3/3.4.13/d3.min.js" type="text/javascript"></script>-->

    <!-- jQuery -->
	<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>

	<!-- Bootstrap Core JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>

	<!-- Custom Theme JavaScript -->
    <script src="https://DeustoTech.github.io/dycon-toolbox-documentation/js/clean-blog.min.js "></script>

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-128123935-4"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-128123935-4');
  </script>


</head>


<body>

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/dycon-toolbox-documentation/">
                 <img src="https://DeustoTech.github.io//dycon-toolbox-documentation/assets/logo_DyConToolbox_v001.png" >
            </a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="/dycon-toolbox-documentation/">Home</a>
                </li>
                
                
                <li>
                    <a href="/dycon-toolbox-documentation/projects/01-documentation">Documentation</a>
                </li>
                
                
                
                <li>
                    <a href="/dycon-toolbox-documentation/projects/02-tutorials">First Steps</a>
                </li>
                
                
                
                <li>
                    <a href="/dycon-toolbox-documentation/projects/03-examples">Examples</a>
                </li>
                
                
                
                <li>
                    <a href="/dycon-toolbox-documentation/projects/04-download">Downloads</a>
                </li>
                
                
                
                <li>
                        <a href="http://cmc.deusto.eus/">Chair of Computational Mathematics</a>
                </li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>


    <!-- Post Header -->
<header class="intro-header">
    <div class="container" style="padding-top: 70px;">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading" style="padding: 0px 0">
                    <h1 class="post-title">OptimalControl <small>Class</small></h1>
				</div>
				
				<h2>Description</h2>
				
				 	This class is able to solve optimal control problems. Optimal control refers to the problem of finding a control law for a given system such that a certain optimality criterion is achieved. The essential features of an optimal control problem are <ul> <li> a cost functional to be minimized;</li> <li> an initial/boundary value problem for a differential equation describing the motion, in order to determine the state of the system;</li> <li> a control function;</li> <li> eventual constraints that have to be obeyed.</li> </ul> The control may be freely chosen within the given constraints, while the state is uniquely determined by the differential equation and the initial conditions. We have to choose the control in such a way that the cost function is minimized. This class allows treating general optimal control problems in the form $$ \begin{equation*} \min_{u\in\mathcal{U}} J, \end{equation*} $$ in which the objective functional $J$ is defined as $$ \begin{equation*} J=\Psi (x(T))+\int _{0}^{T}\mathcal{L}(x(t),u(t)),dt \end{equation*} $$ and where $x$ is the state of a dynamical system with input $u\in\mathcal{U}$, the set of admissible controls $$\begin{equation*} \dot {x}=f(x,u),\quad x(0)=x_{0},\quad u(t)\in\mathcal {U},\quad t\in [0,T]. \end{equation*}$$ Moreover, the class permits to choose among different methods for solving the minimization problem. At the present stage, the methods available are <ul> <li>  <a href='https://deustotech.github.io/dycon-platform-documentation/documentation/mdl01/optimalcontrol/ClassicalDescent'>Classical gradient method</a></li> <li>  <a href='https://deustotech.github.io/dycon-platform-documentation/documentation/mdl01/optimalcontrol/AdaptativeDescent'>Gradient method with adaptive descend step</a></li> <li>  <a href='https://deustotech.github.io/dycon-platform-documentation/documentation/mdl01/optimalcontrol/ConjugateGradientDescent'>Conjugate gradient method</a></li> </ul>

				<h2>Example</h2>
				
				 	<p>First define the vectors</p>

<script type="math/tex; mode=display">symY = \left( \begin{matrix}   y1 \\                                   y2                  \end{matrix} \right)    symU = \left( \begin{matrix}   u1 \\                                   u2                   \end{matrix} \right)</script>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">clear</span><span class="p">;</span>
<span class="n">syms</span> <span class="n">t</span>
<span class="n">symY</span> <span class="o">=</span> <span class="n">sym</span><span class="p">(</span><span class="s1">'y'</span><span class="p">,[</span><span class="mi">2</span> <span class="mi">1</span><span class="p">]);</span>
<span class="n">symU</span> <span class="o">=</span> <span class="n">sym</span><span class="p">(</span><span class="s1">'u'</span><span class="p">,[</span><span class="mi">1</span> <span class="mi">1</span><span class="p">]);</span>
</code></pre></div></div>

<p><strong>Ordinary differential equation</strong></p>

<p>In this case we will define the following differential equation</p>

<script type="math/tex; mode=display">\left( \begin{matrix}   \dot{S} \\                            \dot{I}                  \end{matrix} \right)    =       \left( \begin{matrix}   \lambda - \beta S I - \sigma_1 S \\                               \beta S I - u_1 I - \sigma_2 I                   \end{matrix} \right)</script>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Lambda</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span><span class="nb">beta</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">;</span>
<span class="n">sigma1</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span><span class="n">sigma2</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span>

<span class="n">S</span> <span class="o">=</span> <span class="n">symY</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="n">I</span> <span class="o">=</span> <span class="n">symY</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="n">Fsym</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="o">=</span> <span class="n">Lambda</span> <span class="o">-</span> <span class="nb">beta</span><span class="o">*</span><span class="n">S</span><span class="o">*</span><span class="n">I</span> <span class="o">-</span>  <span class="n">sigma1</span><span class="o">*</span><span class="n">S</span><span class="p">;</span>
<span class="n">Fsym</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="o">=</span> <span class="nb">beta</span><span class="o">*</span><span class="n">S</span><span class="o">*</span><span class="n">I</span> <span class="o">-</span> <span class="n">symU</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">I</span> <span class="o">-</span> <span class="n">sigma2</span><span class="o">*</span><span class="n">I</span> <span class="p">;</span>
</code></pre></div></div>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">FinalTime</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
<span class="n">S0</span> <span class="o">=</span> <span class="mi">100</span> <span class="p">;</span><span class="n">I0</span> <span class="o">=</span> <span class="mi">15</span><span class="p">;</span>
<span class="n">Y0</span> <span class="o">=</span> <span class="p">[</span> <span class="n">S0</span> <span class="p">;</span> <span class="n">I0</span><span class="p">];</span>
<span class="n">Dynamics</span> <span class="o">=</span> <span class="n">ode</span><span class="p">(</span><span class="n">Fsym</span><span class="o">.</span><span class="s1">',symY,symU,'</span><span class="n">Condition</span><span class="s1">',Y0,'</span><span class="n">FinalTime</span><span class="o">'</span><span class="p">,</span><span class="n">FinalTime</span><span class="p">);</span>
</code></pre></div></div>

<p><strong>Cost Functional</strong></p>

<script type="math/tex; mode=display">J = \Psi(Y(T),t) + \int_0^T L(Y(t,U),U(t),t) dt</script>

<p>In this case,</p>

<script type="math/tex; mode=display">J = A \int_0^T (\vert U \vert^2 + I) dt</script>

<p>Now, We can create the control problem</p>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">A</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="n">symPsi</span>  <span class="o">=</span> <span class="n">sym</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="n">symL</span>    <span class="o">=</span> <span class="n">A</span><span class="o">*</span><span class="p">(</span><span class="n">symU</span><span class="o">.'*</span><span class="n">symU</span><span class="p">)</span> <span class="o">+</span> <span class="n">I</span><span class="p">;</span>
<span class="c1">%</span>
<span class="n">iCP1</span> <span class="o">=</span> <span class="n">OptimalControl</span><span class="p">(</span><span class="n">Dynamics</span><span class="p">,</span><span class="n">symPsi</span><span class="p">,</span><span class="n">symL</span><span class="p">);</span>
</code></pre></div></div>

<p>and solve by Classical Gradient Methodcla</p>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">GradientMethod</span><span class="p">(</span><span class="n">iCP1</span><span class="p">,</span><span class="s1">'DescentAlgorithm'</span><span class="p">,</span><span class="o">@</span><span class="n">ClassicalDescent</span><span class="p">)</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>error = 0
error = 5
error = 3.3322
error = 3.3303
error = 3.3249
error = 3.3057
error = 3.2306
error = 2.9476
error = 2.0529
error = 0.51149
error = 0.062916
error = 0.0024618

    Solve with presicion: 

        We obtain: J(u) = 4.419742E+01

        mean(||dJ_i||) = 2.461753E-03

    With 12 iterations,     In 1.0835 seconds


</code></pre></div></div>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">plot</span><span class="p">(</span><span class="n">iCP1</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="https://DeustoTech.github.io//dycon-toolbox-documentation/assets/imgs/MDL01/class/main/OptimalControl/copiaRM_01.png" alt="" /></p>




				<h1>Properties</h1>
				<table>
					<tr>
						<th>Name</th>
            <th>Type</th>
            <th>Default Value</th>
            <th>Description</th>
					</tr>
					
						<tr>
							<th>J</th>
							<th>Functional</th>
							<th>none</th>
							<th>This property represent the cost of optimal control</th>
						</tr>
					
						<tr>
							<th>ode</th>
							<th>ode</th>
							<th>none</th>
							<th>This property represented ordinary differential equation</th>
						</tr>
					
						<tr>
							<th>adjoint</th>
							<th>double</th>
							<th>function_handle</th>
							<th>The derivative of the Hamiltonian with respect to the control u</th>
						</tr>
					
						<tr>
							<th>hamiltonian</th>
							<th>double</th>
							<th>function_handle</th>
							<th>The derivative of the Hamiltonian with respect to the control u</th>
						</tr>
					
						<tr>
							<th>gradient</th>
							<th>struct</th>
							<th>none</th>
							<th>The adjoint propertir contain the numerical function that represents the adjoint problem this struct have a two properties. The first is dP_dt and the second is P0.</th>
						</tr>
					
						<tr>
							<th>solution</th>
							<th>double</th>
							<th>none</th>
							<th>It is an array that contains the different functional values during the execution of the optimization algorithm that has been used.</th>
						</tr>
					
						<tr>
							<th>YT</th>
							<th></th>
							<th></th>
							<th></th>
						</tr>
					
				</table>
        <!-- CONSTRUCTOR  -->
				<h1>Contructor</h1>
				
				

				<h3>Mandatory Input Parameters</h3>
				<table>
					<tr>
						<th>Name</th>
						<th>Description</th>
						<th>class</th>
					</tr>
					
						<tr>
							<th>iode</th>
							<th>Ordinary Differential Equation represent the constrain to minimization the functional</th>
							<th>ode</th>
						</tr>
					
						<tr>
							<th>Jfun</th>
							<th>Cost function to obtain the optimal control</th>
							<th>Functional</th>
						</tr>
					

				</table>
				

				<!-- OPTIONAL INPUTS  -->

				
					<h3>Optional Input Parameters</h3>
					<table>
						<tr>
							<th>Name</th>
							<th>Description</th>
							<th>class</th>
						</tr>
						
							<tr>
								<th>T</th>
								<th>This parameter represent the final time of simulation.</th>
								<th>double</th>
							</tr>
						
							<tr>
								<th>dt</th>
								<th>This parameter represent is the interval to interpolate the control, $u$, and state, $y$, to obtain the functional $J$ and the gradient $dH/du$</th>
								<th>double</th>
							</tr>
						
					</table>
				

				<!--  OUTPUTS -->
				
					<h3>Output Parameters</h3>
					<table>
						<tr>
							<th>Name</th>
							<th>Description</th>
							<th>class</th>
						</tr>
						
						<tr>
							<th>obj</th>
							<th>ControlProblem MATLAB class</th>
							<th>ControlProblem</th>
						</tr>
						
					</table>
				


				<h1>Methods</h1>
				<table>
					<tr>
						<th>Name</th>
						<th>Description</th>
					</tr>
					
					  
					
					  
						<tr>
							
							
							<th><a href="/dycon-toolbox-documentation/documentation/mdl01/optimalcontrol/AdaptativeDescent">AdaptativeDescent</a></th>
							<th>This method is used within the GradientMethod method. GradientMethod executes iteratively this rutine in order to get one update of the control in each iteration.</th>
						</tr>
					  
					
					  
						<tr>
							
							
							<th><a href="/dycon-toolbox-documentation/documentation/mdl01/optimalcontrol/ClassicalDescent">ClassicalDescent</a></th>
							<th>GradientMethod executes iteratively this rutine in order to get one update of the control in each iteration. In the case of choosing ClassicalDescent this function updates the control</th>
						</tr>
					  
					
					  
						<tr>
							
							
							<th><a href="/dycon-toolbox-documentation/documentation/mdl01/optimalcontrol/CoConjugateGradientDescent">CoConjugateGradientDescent</a></th>
							<th>This method is able to update the value of the control by decreasing the value of the functional.</th>
						</tr>
					  
					
					  
						<tr>
							
							
							<th><a href="/dycon-toolbox-documentation/documentation/mdl01/optimalcontrol/CoGradientMethod">CoGradientMethod</a></th>
							<th>The gradient method is able to optimize the given functional, going down the gradient.</th>
						</tr>
					  
					
					  
						<tr>
							
							
							<th><a href="/dycon-toolbox-documentation/documentation/mdl01/optimalcontrol/ConjugateGradientDescent">ConjugateGradientDescent</a></th>
							<th>This method is used within the GradientMethod method. GradientMethod executes iteratively this rutine in order to get one update of the control in each iteration.</th>
						</tr>
					  
					
					  
						<tr>
							
							
							<th><a href="/dycon-toolbox-documentation/documentation/mdl01/optimalcontrol/Copy">Copy</a></th>
							<th>Method capable of obtaining the attached problem and its final condition.</th>
						</tr>
					  
					
					  
						<tr>
							
							
							<th><a href="/dycon-toolbox-documentation/documentation/mdl01/optimalcontrol/GetAdjointProblem">GetAdjointProblem</a></th>
							<th>Method capable of obtaining the attached problem and its final condition.</th>
						</tr>
					  
					
					  
						<tr>
							
							
							<th><a href="/dycon-toolbox-documentation/documentation/mdl01/optimalcontrol/GetFunctional">GetFunctional</a></th>
							<th>Method capable of calculating the value of the functional defined in the control problem.</th>
						</tr>
					  
					
					  
						<tr>
							
							
							<th><a href="/dycon-toolbox-documentation/documentation/mdl01/optimalcontrol/GetGradient">GetGradient</a></th>
							<th>Creates the iCP.dH_du property that contains a numeric function that returns the value of the gradient given the dynamics solution, $Y$ and the associated control, $U$.</th>
						</tr>
					  
					
					  
						<tr>
							
							
							<th><a href="/dycon-toolbox-documentation/documentation/mdl01/optimalcontrol/GetNumericalGradient">GetNumericalGradient</a></th>
							<th>This method is able to update the value of the control by decreasing the value of the functional.</th>
						</tr>
					  
					
					  
						<tr>
							
							
							<th><a href="/dycon-toolbox-documentation/documentation/mdl01/optimalcontrol/GradientMethod">GradientMethod</a></th>
							<th>The gradient method is able to optimize the given functional, going down the gradient.</th>
						</tr>
					  
					
					  
						<tr>
							
							
							<th><a href="/dycon-toolbox-documentation/documentation/mdl01/optimalcontrol/plot">plot</a></th>
							<th>shows how the dynamics, the control and the functional in the optimization evolve.</th>
						</tr>
					  
					
					  
						<tr>
							
							
							<th><a href="/dycon-toolbox-documentation/documentation/mdl01/optimalcontrol/resume">resume</a></th>
							<th>show the most importants parameters of the control problem</th>
						</tr>
					  
					
				</table>


            </div>
        </div>
    </div>
</header>


    <!-- Footer -->
<footer>
  <hr>
  <div class="container">
    <div class="row">
      <div class="col-md-10">
        <ul class="list-inline text-center">
          <li>
            <img style="width: 200px;" src="/dycon-toolbox-documentation/img/logos/logo_DyCon.png " alt="">
          </li>
          <li>
            <img style="width: 250px;" src="/dycon-toolbox-documentation/img/logos/logo_CCM_subDerecha_v002.png " alt="">
          </li>
        </ul>
      </div>
    </div>
  </div>
</footer>


</body>

</html>
