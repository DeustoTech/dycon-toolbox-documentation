



```matlab
import casadi.*

A = [-2  1;
      1 -2];
B = [1;0];
%
tspan = linspace(0,1,7);
idyn = linearode(A,B,tspan);
idyn.InitialCondition = [1;2];
```



```matlab
ts = idyn.ts;
Xs = idyn.State.sym;
Us = idyn.Control.sym;
%
epsilon = 1e4;
PathCost  = Function('L'  ,{ts,Xs,Us},{ Us'*Us           });
FinalCost = Function('Psi',{Xs}      ,{ epsilon*(Xs'*Xs) });

iocp = ocp(idyn,PathCost,FinalCost);
```



```matlab
uguess = tspan;
[uopt,xopt] = ArmijoGradient(iocp,uguess);
```




```
===================================================================================================
|   iter   |   norm(dJ/du)  |  abs(Jc-Ja)/Jc  |  LengthStep  |       J       |   Distance2Target  |
===================================================================================================
|   008    |    2.017e+03   |    1.780e-01    |   2.50e-04   |  1.13750e+03  |       NaN          |
|   012    |    1.651e+03   |    2.549e-01    |   2.50e-04   |  6.18609e+02  |       NaN          |
|   016    |    2.011e+03   |    1.540e-01    |   1.00e-03   |  4.12580e+02  |       NaN          |
|   020    |    3.068e+03   |    4.962e-02    |   1.00e-03   |  3.26251e+02  |       NaN          |
|   024    |    8.769e+02   |    8.368e-02    |   1.00e-03   |  2.07381e+02  |       NaN          |
|   028    |    8.176e+02   |    1.259e-01    |   1.00e-03   |  1.28015e+02  |       NaN          |
|   032    |    1.172e+03   |    7.778e-02    |   1.00e-03   |  1.02105e+02  |       NaN          |
|   036    |    3.997e+02   |    1.316e-01    |   2.50e-04   |  8.07760e+01  |       NaN          |
|   040    |    4.187e+02   |    2.306e-02    |   1.00e-03   |  6.74948e+01  |       NaN          |
===================================================================================================
|   iter   |   norm(dJ/du)  |  abs(Jc-Ja)/Jc  |  LengthStep  |       J       |   Distance2Target  |
===================================================================================================
|   048    |    1.864e+02   |    3.809e-02    |   2.50e-04   |  5.13924e+01  |       NaN          |
|   052    |    1.509e+02   |    3.159e-02    |   2.50e-04   |  4.71590e+01  |       NaN          |
|   056    |    1.803e+02   |    1.423e-02    |   1.00e-03   |  4.55183e+01  |       NaN          |
|   060    |    8.734e+01   |    8.959e-03    |   1.00e-03   |  4.47686e+01  |       NaN          |
|   064    |    7.475e+01   |    1.117e-02    |   2.50e-04   |  4.39292e+01  |       NaN          |
|   068    |    5.289e+01   |    3.286e-04    |   2.50e-04   |  4.35600e+01  |       NaN          |
|   072    |    9.023e+01   |    2.091e-03    |   1.00e-03   |  4.32197e+01  |       NaN          |
|   076    |    3.367e+01   |    1.155e-03    |   1.00e-03   |  4.31266e+01  |       NaN          |
|   080    |    2.741e+01   |    3.512e-05    |   2.50e-04   |  4.30802e+01  |       NaN          |
===================================================================================================
|   iter   |   norm(dJ/du)  |  abs(Jc-Ja)/Jc  |  LengthStep  |       J       |   Distance2Target  |
===================================================================================================

    Mininum Length Step have been achieve !! 


```



```matlab
uopt
```




```

uopt =

   -7.9370   -8.1077   -7.8352   -6.7968   -4.4915   -0.1483    7.4126


```



```matlab
xopt
```




```

xopt =

    1.0000   -0.0772   -0.9118   -1.4622   -1.6301   -1.2395   -0.0019
    2.0000    1.4904    1.0038    0.5701    0.2238    0.0129    0.0094


```



